---
title: "S9-L9: システムプロンプトのコンテキストエンジニアリング"
description: "効果的なシステムプロンプトの設計手法と実例の分析"
sectionNumber: 9
sectionTitle: "Prompt Engineering Theory"
lectureNumber: 9
lectureTitle: "Context Engineering a System Prompt"
udemyLectureId: 52803023
difficulty: "intermediate"
tags: ["system-prompt", "context-engineering", "best-practices", "agents"]
category: "prompt-engineering"
order: 909
---

import Quiz from '@/components/content/Quiz.astro'

## 概要

このレクチャーでは，システムプロンプトの重要性と効果的な設計手法を解説します．Claude Code，Cursor，Devinなどの最先端エージェントのシステムプロンプトを分析し，良いシステムプロンプトと悪いシステムプロンプトの違いを学びます．

## 最先端エージェントのシステムプロンプト

GitHubリポジトリで公開されている各種エージェントのシステムプロンプトを見ると，その規模がわかります．

- Claude Code: 約200行 + 500語のツール説明
- Cursor Agent: 約200行
- Devin: 約400行

これらのプロンプトは継続的に更新され，LLMの進化に合わせて改善が繰り返されています．

## Goldilocksゾーン: 適切なバランス

Anthropicが「Goldilocksゾーン」と呼ぶ，適切なバランスを見つけることが重要です．道を尋ねる時の比喩で考えると:

- 「あっちに行って」では漠然すぎる
- 50ページのマニュアルは情報過多
- 適切な情報量を，明確に提供するのが理想

## 悪いシステムプロンプトの例

### 詳細すぎるプロンプト

問題点:

- LLMを決定論的な状態マシンのように扱っている
- 「ユーザーの意図がインシデント解決なら，3つのフォローアップ質問をする」のような硬直的なルール
- すべてのシナリオを網羅的に列挙（完全に列挙することは不可能）
- メンテナンスの悪夢: 新しいエッジケースごとにプロンプト修正が必要

### 曖昧すぎるプロンプト

問題点:

- 実行可能なガイダンスがない
- 共有コンテキストの誤った前提（モデルがベーカリーの規範を知っていると仮定）
- 未定義の境界（「必要に応じてエスカレート」- いつが「必要」なのか不明）
- 異なる実行ごとに大きく異なるアプローチが発生

```text
詳細すぎる              Goldilocksゾーン          曖昧すぎる
◄──────────────────────────────────────────────────────────►
  硬直的なルール        推論フレームワーク         実行可能な
  メンテナンス困難      原則ベース                 ガイダンスなし
  エッジケース列挙      適切な情報量               未定義の境界
                        ★ 目指すべき場所 ★
```

## 効果的なシステムプロンプトの特徴

### 1. 明確なアイデンティティとスコープ

カスタマーサポート（マーケティングでも営業でもない）と明確に定義し，対応範囲を限定します．

### 2. 制約ではなく権限付与

特定のツールを使うタイミングを細かく指定するのではなく，「効率的かつプロフェッショナルな解決」というゴールを設定し，エージェントが適切なツールを選択できるようにします．

### 3. フローチャートではなく推論フレームワーク

4ステップの対応フレームワークを提供:

1. 核心の問題を特定する
2. 必要なコンテキストを収集する
3. 明確な解決策を提供する
4. 顧客の満足を確認する

### 4. 明確な原則

「複数の解決策がある場合は最もシンプルなものを選ぶ」のようなヒューリスティックを提供します．

## なぜこのアプローチが優れているか

- 詳細すぎるプロンプトは，シナリオが一致しない場合にLLMの性能を悪化させる
- 曖昧すぎるプロンプトは，LLMに十分な情報を与えない
- 適切なプロンプトは，LLMの「パターン認識と一般ルールの特定状況への適用」能力を活用する
- 原則ベースのため，新しい状況にも柔軟に対応できる

## まとめ

- システムプロンプトは極めて重要であり，継続的な改善が必要
- 「詳細すぎる」と「曖昧すぎる」の間の適切なバランス（Goldilocksゾーン）を目指す
- 硬直的なルールではなく，推論フレームワークと原則を提供する
- LLMのパターン認識能力を活かし，制約ではなく権限を与える設計が効果的
- 最先端エージェントのシステムプロンプトは数百行に及び，継続的に更新されている

<Quiz questions={[
  {
    question: "Anthropicが提唱する「Goldilocksゾーン」とは何を指しますか？",
    options: [
      "LLMの最適な温度パラメータの範囲",
      "詳細すぎず曖昧すぎない，適切なバランスのシステムプロンプト",
      "コンテキストウィンドウの最適なサイズ",
      "エージェントの最適な実行時間"
    ],
    answer: 1,
    explanation: "Goldilocksゾーンとは，詳細すぎず曖昧すぎない適切なバランスのシステムプロンプトを指し，Anthropicがこの概念を提唱しています．"
  },
  {
    question: "詳細すぎるシステムプロンプトの主な問題点は何ですか？",
    options: [
      "LLMが理解できない",
      "トークン数が足りなくなる",
      "LLMを決定論的な状態マシンのように扱い，柔軟性を失わせる",
      "他のエージェントと互換性がなくなる"
    ],
    answer: 2,
    explanation: "詳細すぎるプロンプトは，LLMを決定論的な状態マシンのように扱い，硬直的なルールやシナリオの網羅的な列挙がメンテナンスの悪夢を引き起こします．"
  },
  {
    question: "効果的なシステムプロンプトで推奨されるアプローチはどれですか？",
    options: [
      "すべてのシナリオを網羅的に列挙する",
      "フローチャートで詳細な分岐を定義する",
      "推論フレームワークと原則を提供する",
      "最小限の指示のみを与える"
    ],
    answer: 2,
    explanation: "効果的なシステムプロンプトでは，硬直的なフローチャートではなく推論フレームワークと原則を提供し，LLMのパターン認識能力を活用します．"
  },
  {
    question: "Claude Codeのシステムプロンプトはおよそ何行ですか？",
    options: [
      "約50行",
      "約200行 + 500語のツール説明",
      "約1000行",
      "約50語"
    ],
    answer: 1,
    explanation: "Claude Codeのシステムプロンプトは約200行で，それに加えて約500語のツール説明が含まれています．"
  },
  {
    question: "「制約ではなく権限付与」のアプローチとはどういうことですか？",
    options: [
      "エージェントに無制限のアクセス権を与える",
      "特定のツールを使うタイミングを細かく指定する",
      "ゴールを設定し，エージェントが適切なツールを選択できるようにする",
      "すべてのツールを無効にする"
    ],
    answer: 2,
    explanation: "特定のツールを使うタイミングを細かく指定する代わりに，達成すべきゴールを設定し，エージェント自身が状況に応じて適切なツールを選択できるようにするアプローチです．"
  }
]} />
